<!-- كود محدث مع توصيات حقيقية وتحليل فني بسيط -->
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>eo broker smart signal</title>
  <style>
    body {margin: 0; padding: 20px; background-color: #111; color: #eee; font-family: 'Segoe UI', sans-serif; direction: rtl;}
    .container {max-width: 500px; margin: auto;}
    h1 {text-align: center; color: #0ff;}
    .signal-box {background-color: #222; padding: 20px; border-radius: 10px; margin-bottom: 20px;}
    .label {color: #aaa; font-weight: bold;}
    .value {font-size: 1.2em; margin-bottom: 10px;}
    button {width: 100%; padding: 10px; margin-top: 10px; background-color: #0ff; color: #000; border: none; font-size: 16px; border-radius: 6px; cursor: pointer;}
    .history {background-color: #181818; padding: 15px; border-radius: 10px;}
    input {padding: 8px; width: 100%; margin-bottom: 10px; border: none; border-radius: 5px;}
    #admin-form {display: none; background: #222; padding: 15px; margin-top: 15px; border-radius: 8px;}
  </style>
</head>
<body>
<div class="container">
  <h1>📡 eo broker smart signal</h1>

  <div class="signal-box" id="signalBox">
    <div class="label">📈 التوصية:</div>
    <div class="value" id="recommendation">جاري الاتصال...</div>

    <div class="label">💱 السعر:</div>
    <div class="value" id="price">-</div>

    <div class="label">🎯 الهدف:</div>
    <div class="value" id="tp">-</div>

    <div class="label">🛑 وقف الخسارة:</div>
    <div class="value" id="sl">-</div>

    <div class="label">⏱ مدة الصفقة:</div>
    <div class="value" id="duration">30 ثانية</div>

    <div class="label">📊 نسبة الثقة:</div>
    <div class="value" id="confidence">-</div>
  </div>

  <button onclick="generateSignal()">🔁 تحديث التوصية</button>

  <div class="history">
    <div class="label">📋 سجل التوصيات:</div>
    <ul id="historyList"></ul>
  </div>

  <button onclick="promptAdmin()">🔓 دخول المشرف</button>

  <div id="admin-form">
    <input type="text" id="manualType" placeholder="شراء / بيع">
    <input type="text" id="manualPrice" placeholder="السعر">
    <input type="text" id="manualTP" placeholder="Take Profit">
    <input type="text" id="manualSL" placeholder="Stop Loss">
    <input type="text" id="manualDuration" placeholder="مدة الصفقة">
    <input type="text" id="manualConfidence" placeholder="نسبة الثقة">
    <button onclick="submitManual()">✅ نشر التوصية اليدوية</button>
  </div>
</div>

<script>
  const ws = new WebSocket("wss://ws.derivws.com/websockets/v3?app_id=1089");

  ws.onopen = () => {
    ws.send(JSON.stringify({ticks_subscribe: "frxEURUSD"}));
  };

  let lastPrice = 0;

  ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    if (data.tick) {
      lastPrice = parseFloat(data.tick.quote).toFixed(5);
      document.getElementById("price").textContent = lastPrice;
      generateSignal(); // تحديث التوصية بمجرد وصول السعر
    }
  };

  function generateSignal() {
    const price = parseFloat(lastPrice);
    let recommendation = "⏳ السوق غير واضح";
    let tp = "-", sl = "-", confidence = "50%";

    if (price > 1.0880) {
      recommendation = "📉 بيع";
      tp = (price - 0.0004).toFixed(5);
      sl = (price + 0.0003).toFixed(5);
      confidence = "92%";
    } else if (price < 1.0820) {
      recommendation = "📈 شراء";
      tp = (price + 0.0004).toFixed(5);
      sl = (price - 0.0003).toFixed(5);
      confidence = "91%";
    }

    document.getElementById("recommendation").textContent = recommendation;
    document.getElementById("tp").textContent = tp;
    document.getElementById("sl").textContent = sl;
    document.getElementById("confidence").textContent = confidence;

    const log = `${recommendation} @ ${price} 🎯 ${tp} / 🛑 ${sl} / 📊 ${confidence}`;
    const li = document.createElement("li");
    li.textContent = log;
    document.getElementById("historyList").prepend(li);
  }

  function promptAdmin() {
    const pin = prompt("🔐 أدخل رمز الدخول:");
    if (pin === "2025") {
      document.getElementById("admin-form").style.display = "block";
    } else {
      alert("❌ رمز خاطئ!");
    }
  }

  function submitManual() {
    const type = document.getElementById("manualType").value;
    const entry = document.getElementById("manualPrice").value;
    const tp = document.getElementById("manualTP").value;
    const sl = document.getElementById("manualSL").value;
    const duration = document.getElementById("manualDuration").value;
    const confidence = document.getElementById("manualConfidence").value;

    document.getElementById("recommendation").textContent = type;
    document.getElementById("price").textContent = entry;
    document.getElementById("tp").textContent = tp;
    document.getElementById("sl").textContent = sl;
    document.getElementById("duration").textContent = duration;
    document.getElementById("confidence").textContent = confidence;

    const log = `${type} @ ${entry} 🎯 ${tp} / 🛑 ${sl} / ⏱ ${duration} / 📊 ${confidence}`;
    const li = document.createElement("li");
    li.textContent = log;
    document.getElementById("historyList").prepend(li);
  }
</script>
</body>
</html>
